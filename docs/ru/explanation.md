# Трудности написания

_Переключить язык на: [английский](../en/explanation.md)_

_Я не специалист в этой теме, а с японским языком меня связывает только желание его выучить._

Здесь описаны некоторые особенности японского произношения и письменности. Этими особенностями вызваны трудности, с которыми я столкнулся при написании мини-библиотеки kana-transcription.

>_transformToKana()_
>
>1. [Зависимость чтения слога от позиции](#зависимость-чтения-слога-от-позиции)
>2. [Разные обозначения долготы гласных](#разные-обозначения-долготы-гласных)
>3. [Разделение ряда _на_ и слоговой _н_](#разделение-ряда-на-и-слоговой-н)
>4. [Определение неслышной гласной и долгой согласной](#определение-неслышной-гласной-и-долгой-согласной)
>5. [Неслышный гласный: _и_ или _у_?](#неслышный-гласный-и-или-у)
>
>_transcriptKana()_
>
>6. [Распознавание частиц](#распознавание-частиц)
>7. [Понимание слоговой _н_](#понимание-слоговой-н)
>8. [Распознавание долгих гласных](#распознавание-долгих-гласных)
>
>_reverseKana()_
>
>9. [Распознавание долгих гласных в хирагане](#распознавание-долгих-гласных-в-хирагане)


## Введение

### Азбука

Помимо иероглифов, в японской письменности используются две слоговые азбуки (каны): хирагана и катакана. В каждой азбуке по 46 символов, каждый из которых означает слог (за исключением ん/ン - этим символом обозначают согласный _н_). В результате каждый слог имеет два символа для отображения на письме: один из хираганы, другой из катаканы.

|| в|р|й|м|х|н|т|с|к| |согл/глас|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
||わ/ワ|ら/ラ|や/ヤ (я)|ま/マ|は/ハ|な/ナ|た/タ|さ/サ|か/カ|あ/ア|а|
|||り/リ||み/ミ|ひ/ヒ|に/ニ|ち/チ|し/シ|き/キ|い/イ|и|
|||る/ル|ゆ/ユ (ю)|む/ム|ふ/フ|ぬ/ヌ|つ/ツ|す/ス|く/ク|う/ウ|у|
|||れ/レ||め/メ|へ/ヘ|ね/ネ|て/テ|せ/セ|け/ケ|え/エ|э|
||を|ろ/ロ|よ/ヨ (ё)|も/モ|ほ/ホ|の/ノ|と/ト|そ/ソ|こ/コ|お/オ|о|
|ん/ン (н)|

В японском больше 46 слогов. Некоторые из недостающих обозначаются на письме добавлением специальных знаков к основным символам: _нигори ゛_ или _ханнигори ゜_.

#### Хирагана

Зачастую дополняет слово, которое пишется иероглифами, являя собой его части (суффиксы). Иногда иероглифы не используют, и слово пишется только хираганой.

Также ей записываются некоторые вспомогательные части речи, как частицы, союзы и наречия.

#### Катакана

Как правило используется по двум причинам: либо при записи иностранных слов, имён; либо чтобы то или иное понятие выделить из общего ряда (катакана отличается более резкими чертами).

### Особенности речи и письма

#### Разделение слов

Для разделения слов не используются пробелы и прочие символы, что типично для иероглифической письменности. Обычно, чтобы отделить одно слово от другого, хотя бы одно из них нужно знать.

#### Частицы

Некоторые каны могут выступать в роли частиц. В этом случае их произношение меняется:

- は произносится [ва]
- へ произносится [э]
- を произносится [о]

#### Долгая гласная

##### Хирагана

В зависимости от слова принято обозначать долготу гласной по-разному:

- Удвоение - общий для всех гласных метод
- [и] после [э] _зачастую_ означает долгую [э]
- [у] после [о] _зачастую_ означает долгую [о]

##### Катакана

Здесь всё проще: всегда используется _символ ー_ .

#### Неслышная гласная

Гласные [и] и [у], стоящие между глухими согласными или после них, часто произносятся тише, вплоть до того, что и вовсе могут быть неслышны. Притом слоги с [и] чаще передают мягкие согласные (ました - [мащта]), а с [у] - твёрдые (です - [дес]).

#### Двойной, или долгий согласный

Нередко можно встретить слова, в которых согласный произносится дольше или с небольшой задержкой. При письме такой слог выделяют уменьшенной каной っ (в хирагане) или ッ (в катакане). 

#### Слоговая _н_

ん / ン - единственная кана, не оканчивающаяся гласным звуком. Перед разными звуками произносится по-разному.

#### Знаки с одинаковым произношением

В рядах _са_ и _та_ путём прибавления нигори образуются по два символа, произносимых одинаково:

|Чтение/ряд|са|та|
|----------|:-:|:--:|
|дзи|じ/ジ|ぢ/ヂ|
|дзу|ず/ズ|づ/ヅ|

Почти всегда употребляются знаки ряда _са_, но в некоторых случаях, например, когда перед знаком стоит та же буква, используются символы ряда _та_. 


## Обоснование трудностей

Выше я постарался дать информацию, нужную для понимания проблем, изложенных дальше. Пишу о том, что либо не было решено, либо решено частично.

_Под решением чаще имеется в виду не выход из ситуации, а некоторый компромисс, принятый, поскольку лучшего пути я не нашёл._

### Приведение к кане

Мотивацией для создания библиотеки было дать возможность людям искать иероглифы, используя не только кану, но и свои алфавиты (сейчас это доступно для русского и английского языков). Скажем, если не установлен японский алфавит. За это отвечает `transformToKana()`. Выходит, в идеале функция должна передавать точное написание из данной пользователем транскрипции.



#### Зависимость чтения слога от позиции

Актуально, если к кане приводится не одно слово, а несколько слов или предложение: частицы, слоговая _н_, неслышный гласный - всё это можно обработать верно (или _почти_ верно) при условии понимания позиции символа в слове.

##### Решение

Понять позицию символа в слове можно при одном условии - если слова что-то разделяет. По классике, для этого принят пробел.

Отсюда же появляется возможность отследить символы, стоящие до или после данного слога (иначе нельзя было бы сказать, не является ли символ первым или последним в слове). Это знание в т. ч. находит применение при отличии слогов в рядах са - та.




#### Разные обозначения долготы гласных

Долгая [о] одинаково верно может быть приведена к кане как おお и как おう. Различия в написании от слова к слову предлагается запомнить, а что до написания алгоритма - тупик. Та же ситуация с ええ - えい.

##### Решение (хирагана)

Остаётся выбрать меньшее из зол и использовать первый вариант. За счёт этого некоторые слова будут записаны неверно, но хотя бы однозначным останется чтение.

##### Катакана

Написанное выше применимо для хираганы, с катаканой ситуация сложнее. Удлинение гласной записывается _символом ー_. Но нельзя отличить, является ли гласная продолжением предыдущей, или она должна быть прочитана как отдельный элемент.

##### Решение (катакана)

_Символ ー_ в итоге **не употребляется**. Как и с хираганой - некоторые (и даже многие) слова будут записаны неверно, зато верное чтение _не будет исключено_ как один из вариантов.




#### Разделение ряда _на_ и слоговой _н_

Слоговая _н_ может быть перепутана с рядом _на_, так как после первой также могут идти гласные. В итоге, неверная запись.

##### Решение

Чтобы отличать слоговую _н_ после неё принято ставить специальный знак:

- _(на русском)_ - твёрдый знак _ъ_
- _(на английском)_ - апостроф _'_




#### Определение неслышной гласной и долгой согласной

Поскольку гласная неслышная, в случае, если в одном слове вводятся две согласные подряд (и первая согласная - не слоговая _н_), они интерпретируются либо как неслышная гласная, либо как долгая согласная. Для образования двойной согласной буква должна совпадать со следующей, однако это ненадёжный метод проверки: после неслышной гласной может стоять слог этого же ряда, из-за чего идущие друг за другом согласные будут совпадать.

##### Решение

Как такового ответа нету; я выбрал стратегию, которая даёт правильное написание _чаще_: если согласный совпадает со следующим - понимать как долгий согласный, иначе - это неслышный гласный.




#### Неслышный гласный: _и_ или _у_?

В зависимости от языков точность будет отличаться

##### Решение (_русский_)

Для русского языка всё проще: так как _обычно_ неслышная _и_ употребляется с мягкими согласными, остаётся отличить мягкие от твёрдых. Для этого после такого согласного должен стоять мягкий знак _ь_ (или согласный должен быть всегда мягким, как [щ], [ч]).

##### Решение (_английский_)

И снова как такового решения нет - **каждый** неслышный гласный интерпретируется как _у_ - только от того, что он используется чаще.


### Транскрипция каны

Тут проблем уже меньше, да и они по сути описаны ранее. Функция - `transcriptKana()`



#### Распознавание частиц

Без понимания позиции неизвестно, как читаются некоторые каны:

- は - [ха] или [ва] ?
- へ - [хэ] или [э] ?
- を - [во] или [о] ?

##### Решение

Разделять слова с помощью пробела.

Правда, использовать функцию по принципу _скопировал - вставил_ будет не очень удобно.




#### Понимание слоговой _н_</h4>

Поскольку в зависимости от позиции её произношение меняется, то и транскрипция должна отличаться.

##### Решение (_русский_)

Пользуясь системой Поливанова, выводим:
- _м_ - перед звуками [б], [п], [м]
- _нъ_ - перед гласными
- _н_ - в остальных случаях

##### Решение (_английский_)

По пересмотренной системе Хепбёрна получаем:
- _n'_ - перед гласными
- _n_ - в остальных случаях




#### Распознавание долгих гласных

Бывает трудно отличить, где конструкция из двух гласных произносится как долгая первая гласная, а где означает два разных звука:
えい может значить как [эи], так и [ээ]; то же и с おう.

##### Решение

Чтобы у человека, знающего проблемы алгоритма, _хотя бы была возможность_ прочитать слово близко к оригиналу, решено делать побуквенный перевод. То есть из おう будет получено _оу_.


### Приведение одной каны к другой

У этой функции - `reverseKana()` - только одна проблема, но проблема серьёзная.



#### Распознавание долгих гласных в хирагане

В хирагане две одинаковые, стоящие друг за другом гласные могут быть прочитаны двояко: и как долгая гласная, и как две отдельные гласные. Катакана же маркирует долгий гласный _специальным символом ー_. Значит, в ходе получения катаканы из хираганы функция должна отличать долгий гласный и два раздельных гласных.

Та же проблема с неоднозначностью прочтений おう и えい.


##### Решение

Чтобы не исключать верный вариант чтения, ***символ ー не используется***. Это, к сожалению, часто приводит к неверному написанию.

